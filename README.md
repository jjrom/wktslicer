wktslicer
=========

Cut POLYGON WKT into slices or parts. Useful to cut a big polygon like a satellite footprint into smaller parts to speed up database indexing

Original WKT 

![original](https://raw.github.com/jjrom/wktslicer/master/img/wkt_original.png)

WKT cut between -70 and 70 degrees latitude

![cut](https://raw.github.com/jjrom/wktslicer/master/img/wkt_cut70.png)

WKT cut into 10 degrees latitude slices

![slice](https://raw.github.com/jjrom/wktslicer/master/img/wkt_slice10.png)


WKT cut into 10 degrees square parts

![grid](https://raw.github.com/jjrom/wktslicer/master/img/wkt_grid10.png)


Installation
============

We suppose that $WKTSLICER_HOME is the directory containing this file

Prerequesites
-------------

* PHP (v5.3.6+) command line
* PostgreSQL (v8.4+)
* PostGIS (v1.5.1+)

Short story
-----------

Just the installer/launcher

		cd $WKTSLICER_HOME
		./wktslicerRun.sh $DATA_FOLDER

Where DATA_FOLDER is a folder containing SIPAD XML files, i.e. files with the following structure : 


		<SIPAD_DATA xmlns="http://cnes.fr/dico_SIPAD"
			xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
			xsi:schemaLocation="http://cnes.fr/dico_SIPAD SIPAD_Dictionary_ICARE_V1.0.xsd"
			PROJECT_NAME="icare">

			<DATA_OBJECT_DESCRIPTION_POLDER ENTITY_TYPE="DATA_OBJECT_DESCRIPTION">
				<DATA_OBJECT_IDENTIFIER>P3L1TBG1006137S</DATA_OBJECT_IDENTIFIER>
				<ASCENDING_NODE>DA_TC_PARASOL_POLDER3_L1B</ASCENDING_NODE>
				<TIME_PERIOD>
					<START_DATE>2005-03-04T09:06:15</START_DATE>
					<STOP_DATE>2005-03-04T09:49:12</STOP_DATE>
				</TIME_PERIOD>
				<CYCLE_NUMBER>6</CYCLE_NUMBER>
				<ORBIT_NUMBER>137</ORBIT_NUMBER>
				<GEO_POLYGON>
					POLYGON ((40.8495145631068 82.6944444444444, -10.8718487394958 72.9166666666667, 26.2868710237131 57.75, 29.3945831120552 54.4722222222222, 32.0954254795868 51.1388888888889, 34.453125 47.8055555555556, 36.4896373056995 44.3611111111111, 38.2408163265306 40.8611111111111, 39.8796116504854 37.3611111111111, 41.3197026022305 33.8611111111111, 42.6349660350375 30.3055555555556, 43.8333909436571 26.75, 45.0 23.1944444444444, 46.0759908286931 19.5833333333333, 47.0658105939005 15.9722222222222, 47.9867256637168 12.4166666666667, 48.8788257339163 8.80555555555556, 49.7273008986675 5.13888888888889, 50.5433775856746 1.52777777777777, 51.2816553428042 -2.13888888888889, 52.0626550868486 -5.75, 52.8003754693367 -9.41666666666667, 53.486529318542 -13.1388888888889, 54.2088301643571 -16.75, 54.8946675444371 -20.3611111111111, 55.5694491382224 -24.0277777777778, 56.1833391425584 -27.6944444444444, 56.867774566474 -31.3055555555556, 57.5254237288136 -34.9722222222222, 58.1390754642434 -38.6388888888889, 58.8115095913261 -42.25, 59.4813829787234 -45.8611111111111, 60.1283880171184 -49.5277777777778, 60.8796296296296 -53.1388888888889, 61.5388951521984 -56.8055555555555, 62.4157303370786 -60.3611111111111, 63.2278481012658 -63.9722222222222, 64.1504854368932 -67.5833333333333, 65.4 -71.0833333333333, 66.6315789473684 -74.6944444444445, 68.8636363636364 -78.25, 72.1935483870968 -81.75, 79.589552238806 -85.25, 117.096774193548 -88.3611111111111, -142.363636363636 -87.0833333333333, 163.40206185567 -74.3611111111111, 149.479166666667 -74.5277777777778, 135.298672566372 -73.8055555555555, 123.635437881874 -72.3611111111111, 113.983516483516 -70.3055555555555, 106.363636363636 -67.8611111111111, 100.153846153846 -65.0833333333333, 95.1021753460778 -62.0833333333333, 91.0239520958084 -58.9722222222222, 87.6302797586396 -55.75, 84.7568389057751 -52.4722222222222, 82.2384542884072 -49.0833333333333, 80.0662251655629 -45.6388888888889, 78.0898876404494 -42.1388888888889, 76.4164361912288 -38.6388888888889, 74.8867924528302 -35.1388888888889, 73.5326086956522 -31.5833333333333, 72.2202797202797 -28.0277777777778, 71.0783316378433 -24.4722222222222, 69.9372523117569 -20.8611111111111, 68.9107950872657 -17.25, 67.9574332909784 -13.6944444444444, 67.0626959247649 -10.0833333333333, 66.1789375582479 -6.47222222222223, 65.3306551297899 -2.80555555555556, 64.5277777777778 0.805555555555557, 63.7801857585139 4.41666666666667, 63.0392768079801 8.02777777777777, 62.2596911440277 11.6944444444444, 61.5834932821497 15.25, 60.9099804305284 18.8611111111111, 60.2104208416834 22.4722222222222, 59.5360824742268 26.0833333333333, 58.8596802841918 29.6944444444444, 58.1942392909897 33.3055555555556, 57.5096525096525 36.9166666666667, 56.920892494929 40.4722222222222, 56.2017167381974 44.0277777777778, 55.5336692624828 47.6388888888889, 54.8423645320197 51.1944444444444, 54.0385645420461 54.8055555555556, 53.3117647058824 58.3611111111111, 52.4655737704918 61.9166666666667, 40.8495145631068 82.6944444444444))
				</GEO_POLYGON>
				<OBJECT_VERSION>S</OBJECT_VERSION>
				<FILE_SIZE>579054</FILE_SIZE>
				<DATA_STORAGE_OBJECT_IDENTIFIER>P3L1TBG1006137SD</DATA_STORAGE_OBJECT_IDENTIFIER>
				<DATA_STORAGE_OBJECT_IDENTIFIER>P3L1TBG1006137SL</DATA_STORAGE_OBJECT_IDENTIFIER>
				<BROWSE_OBJECT_IDENTIFIER>P3L1TBG1006137SB</BROWSE_OBJECT_IDENTIFIER>
			</DATA_OBJECT_DESCRIPTION_POLDER>

			[...etc...]

		</SIPAD_DATA>

Long story
----------

You can also launch each steps indivudally instead of using the wktslicerRun.sh wrapper

1. Install database

        cd $WKTSLICER_HOME/scripts/installation
        ./wktslicerInstallDB.sh -F -d path_to_postgis_directory

2. Ingest SIPAD XML files

        php $WKTSLICER_HOME/scripts/wktslicerIngestXML.php -f $WKTSLICER_HOME/data/

3. Cut WKT with identifier P3L1TBG1015134J between latitude -70 and 70 degrees - output in GeoJSON

		php $WKTSLICER_HOME/scripts/wktslicerSlice.php -i P3L1TBG1015134J -o geojson -t slice

4. Slice WKT with identifier P3L1TBG1015134J into slices - output in GeoJSON

		php $WKTSLICER_HOME/scripts/wktslicerSlice.php -i P3L1TBG1015134J -o geojson -t slice

5. Slice WKT with identifier P3L1TBG1015134J into parts - output in GeoJSON

		php $WKTSLICER_HOME/scripts/wktslicerSlice.php -i P3L1TBG1015134J -o geojson -t grid

6. Slice all WKTs from the database into slices of 10 degrees - output in csv

		php $WKTSLICER_HOME/scripts/wktslicerSlice.php -i ALL -o csv -t slice > out.csv

7. Export WKT with identifier P3L1TBG1015134J to GeoJSON

		php $WKTSLICER_HOME/scripts/wktslicerToGeoJSON.php -i P3L1TBG1015134J

